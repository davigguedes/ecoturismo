<!--   POR ALGUM MOTIVO A PAGINA DE LOGIN SO FUNCINOU COM O CSS E JS NO MESMO ARQUIVO
        PS: NAO ME PERGUNTE O PQ :(
-->

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="../css/login.css">
</head>
<body>
        <div class="box">
            <form id="loginform"> 
                <h1 style="text-align: center;"> Login</h1>
                <div class="input-field">
                <input type="email" id="email" required>
                <label>Inserir Email</label>
                </div>
                <div class="input-field">
                <input type="password" id="senha"required>
                <label>Inserir Senha</label>
                </div>
                <div class="button_login"> 
                    <button type="submit" id="loginButton">Login</button><br>
                </div>
                <h2></h2>
                <div class="button_criarConta"> 
                    <button id="criar" type="button"> Criar Conta </button>
                </div>
                <div class="forget">
                    <a href="#">
                        <p> Esqueceu a Senha? </p>
                    </a>
                </div>
            </form>
            
        </div>

<!--<img src="/assets/pages/telaLogada.html" -->


    <script>
        document.getElementById('loginform').addEventListener('submit', async (event) => {
            event.preventDefault();
            const email = document.getElementById('email').value.trim();
            const senha = document.getElementById('senha').value.trim();

            if (!email || !senha) {
                alert('Digite um email e senha!');
                return;
            }

            let formData = new FormData();
            formData.append("email", email);
            formData.append("senha", senha);

            try {
                //const response= await fetch('/ecoturismo/ecoturismo/assets/json/testelogin.json')
                //const response= await fetch('/ecoturismo/ecoturismo/assets/json/testelogin.json',{
                const response = await fetch('https://flask-ecoturismo-humbertosamora.replit.app/login', {
                    method: 'POST',
                    // headers:{ 'Content-Type': 'application/json'},
                    body: formData,
                    credentials: 'include'
                    // body: JSON.stringify({email, senha})
                });

                const result = await response.json();

                if (response.ok) {
                    sessionStorage.setItem('userData', JSON.stringify(result));
                    alert('Login Realizado com sucesso.');
                    window.location.href = '/assets/pages/telaLogada.html';
                } else {
                    alert(result.message || 'Email ou senha invÃ¡lidos, tente novamente');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Erro ao fazer login, tente novamente');
            }
        });


// Cadastrar
const criarButton = document.getElementById("criar");
const modal = document.getElementById("modal");
const fechaModal = document.querySelector(".close");

criarButton.addEventListener("click",()=>{
    modal.style.display = "block";
});

fechaModal.addEventListener("click",() =>{
    modal.style.display = "none";
});
window.addEventListener("click", (event)=>{
    if(event.target ===modal){
        modal.style.display="none";
    }
});



    </script>

</body>
</html>
